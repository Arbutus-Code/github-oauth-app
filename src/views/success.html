<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Authentication Success</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #f0f0f0;
        color: #333;
        text-align: center;
      }
      .container {
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #4caf50;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Success! (Debug Mode)</h1>
      <p id="status-message">Attempting to send authentication details...</p>
      <div style="text-align: left; margin-top: 20px;">
        <p><strong>Token:</strong> <code id="token-display"></code></p>
        <p><strong>Target Origin:</strong> <code id="origin-display"></code></p>
        <p><strong>Full Message:</strong> <code id="message-display"></code></p>
      </div>
    </div>
    <script>
      (function () {
        const params = new URLSearchParams(window.location.search);
        const token = params.get("token");
        const origin = params.get("origin") || "*"; // Default to '*' if origin not specified, though it should be
        const provider = "github"; // As per current setup

        if (window.opener) {
          const jsonData = JSON.stringify({ token: token, provider: provider });
          const message = `authorization:${provider}:success:${jsonData}`;

          // Ensure a specific origin is used in production for security
          // For development, '*' might be okay, but the plan implies a specific FRONTEND_URL
          // and is passed as the 'origin' parameter to this page.
          // Display the data being sent
          document.getElementById('token-display').textContent = token || 'Not found';
          document.getElementById('origin-display').textContent = origin || 'Not found';
          document.getElementById('message-display').textContent = message || 'Not found';

          window.opener.postMessage(message, origin);
          // window.close(); // Keep window open for debugging

          document.getElementById('status-message').textContent = 'Message sent. This window will remain open for debugging.';
        } else {
          console.error("No opener window found. Cannot post message.");
          document.getElementById('status-message').textContent = 'Error: No opener window found. Cannot post message.';
          document.getElementById('token-display').textContent = 'N/A';
          document.getElementById('origin-display').textContent = 'N/A';
          document.getElementById('message-display').textContent = 'N/A';
        }
      })();
    </script>
  </body>
</html>
